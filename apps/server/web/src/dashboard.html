<!doctype html>
<html lang="en">
  <head>
    <%= metadata %>
    <title>Resumemk | Dashboard</title>
  </head>
  <body class="max-w-[1980px] mx-auto">
    <nav class="flex justify-between border-b-1 border-foreground px-6 py-2">
      <a href="/">
        <img src="/favicon.ico" alt="App Logo" class="h-8 w-8" />
      </a>
      <div class="flex items-center">
        <button class="btn btn-sm btn-ghost text-base" id="open_modal_btn">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="lucide lucide-plus-icon lucide-plus"
          >
            <path d="M5 12h14" />
            <path d="M12 5v14" />
          </svg>
          New document
        </button>
      </div>
    </nav>

    <ul
      id="resumes_container"
      class="mt-4 px-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 place-items-center gap-6 w-full"
    ></ul>

    <div
      class="fixed inset-0 z-50 items-center justify-center bg-black/50 hidden px-6 lg:px-0"
      id="my_modal"
    >
      <div
        class="bg-background rounded-lg shadow-lg p-6 w-full max-w-md m-auto my-16 transition-opacity duration-300"
      >
        <div class="flex justify-between items-start mb-4">
          <h2 class="text-lg font-semibold text-foreground">
            Create New Document
          </h2>
          <button
            class="close-modal-btn btn-ghost hover:cursor-pointer rounded-md"
            id="close_modal_btn"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              class="lucide lucide-x"
            >
              <path d="M18 6 6 18" />
              <path d="m6 6 12 12" />
            </svg>
          </button>
        </div>

        <div class="mb-2">
          <label
            for="document_name"
            class="block text-sm font-medium text-muted-foreground"
            >Document Name</label
          >
          <input
            type="text"
            id="document_name"
            placeholder="Enter document name"
            class="input w-full"
          />
        </div>

        <div class="mb-4">
          <input
            type="checkbox"
            id="use_template"
            class="mr-2 input"
            name="use_template"
            value="Use template"
            checked
          />
          <label for="use_template" class="text-sm font-medium"
            >Use Template</label
          >
        </div>

        <div class="flex justify-end">
          <button
            class="btn btn-outline btn-sm mr-2 close-modal-btn"
            id="cancel_btn"
          >
            Cancel
          </button>
          <button class="btn btn-primary btn-sm" id="create_document_btn">
            Create
          </button>
        </div>
      </div>
    </div>
    <script src="/resume_store.js"></script>
    <script type="module">
      const openModalBtn = document.getElementById("open_modal_btn");
      const closeModalBtn = document.querySelectorAll(".close-modal-btn");
      const createDocumentBtn = document.getElementById("create_document_btn");
      const documentNameInput = document.getElementById("document_name");
      const useTemplateInput = document.getElementById("use_template");
      const myModal = document.getElementById("my_modal");
      const resumesContainer = document.getElementById("resumes_container");
      let resumes = getResumes();

      createDocumentBtn.addEventListener("click", () => {
        const documentName = documentNameInput.value;
        const useTemplate = useTemplateInput.checked;
        if (documentName && documentName.trim() !== "") {
          const docId = generateResumeId();
          const resume = {
            id: docId,
            title: documentName,
            content: useTemplate ? DEFAULT_RESUME : "",
            css: useTemplate ? DEFAULT_STYLES : "",
          };

          saveResume(resume);
          resumes.push(resume);
          documentNameInput.value = "";
          displayResumes();
          myModal.classList.add("hidden");
        } else {
          alert("Please enter a document name.");
        }
      });

      myModal.addEventListener("click", (e) => {
        e.stopPropagation();
        if (e.target === myModal) {
          myModal.classList.add("hidden");
        }
      });

      openModalBtn.addEventListener("click", () => {
        myModal.classList.remove("hidden");
        documentNameInput.focus();
      });

      closeModalBtn.forEach((btn) => {
        btn.addEventListener("click", () => {
          myModal.classList.add("hidden");
        });
      });

      function displayResumes() {
        resumesContainer.innerHTML = "";
        if (!resumes || resumes.length === 0) {
          resumesContainer.innerHTML =
            "<p class='text-gray-500 text-center'>No resumes created yet.</p>";
          return;
        }

        resumes.forEach((resume) => {
          const listItem = document.createElement("li");
          listItem.classList.add(
            "bg-card",
            "rounded-lg",
            "shadow-md",
            "flex",
            "justify-between",
            "items-center",
          );

          const previewContent = resume.content.substring(0, 250);
          const preview = `<p class="text-gray-700">${previewContent}${previewContent.length > 0 ? "..." : ""}</p>`;

          const trashIcon = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-trash2-icon lucide-trash-2"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>`;
          const viewIcon = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-eye-icon lucide-eye"><path d="M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0"/><circle cx="12" cy="12" r="3"/></svg>`;

          listItem.innerHTML = `
              <div>
                <nav class="flex justify-between items-center text-lg py-2 bg-primary text-on-primary rounded-t-lg px-4">
                  <h3 class="font-bold">${resume.title}</h3>
                  <div class="flex">
                    <button class="btn btn-sm text-on-tertiary btn-remove-resume" data-id="${resume.id}">${trashIcon}</button>
                    <a class="btn btn-sm text-on-tertiary" href="/resume.html?id=${resume.id}">${viewIcon}</a>
                  </div>
                </nav>
                <div class="bg-surface text-on-surface py-2">
                  ${preview}
                </div>
              </div>
          `;

          resumesContainer.appendChild(listItem);
          const deleteButtons = document.querySelectorAll(".btn-remove-resume");
          deleteButtons.forEach((button) => {
            button.addEventListener("click", (event) => {
              const resumeId = event.target.dataset.id;
              if (!resumeId) {
                console.log("No resumeId.");
                return;
              }
              deleteResume(resumeId);
              resumes = getResumes();
              displayResumes();
            });
          });
        });
      }
      displayResumes();
    </script>
  </body>
</html>
